# 飞书权限配置指南

## 问题说明

如果在使用文档上传功能时遇到错误：
```
文件上传失败: 创建文档失败: Request failed with status code 400
```

日志中显示：
```
错误代码: 99991672
错误详情: permission_violations
```

这是由于飞书应用缺少创建文档的权限。

## 解决方案

### 步骤1：登录飞书开放平台

访问：https://open.feishu.cn/app

### 步骤2：找到你的应用

在应用列表中找到应用ID为 `cli_a905db090c38dbb3` 的应用

### 步骤3：申请权限

1. 点击应用进入详情页
2. 点击左侧菜单的"权限管理"
3. 点击"权限申请"或"权限配置"
4. 搜索并申请以下权限：

#### 必需权限

- **docx:document:create**
  - 描述：创建文档
  - 作用：允许应用创建飞书云文档

- **docx:block:children:create**
  - 描述：创建文档块
  - 作用：允许应用向文档中添加内容

- **docx:block:children:list**
  - 描述：获取文档内容
  - 作用：允许应用读取文档内容

#### 可选权限

- **docx:document:delete**
  - 描述：删除文档
  - 作用：允许应用删除文档（如需此功能）

### 步骤4：等待审核

- 权限申请通常需要几分钟到几小时审核
- 如果是个人应用，通常可以立即通过
- 如果是企业应用，可能需要企业管理员审批

### 步骤5：重新测试

权限审核通过后，重新尝试上传文件。

## 常见问题

### Q: 权限审核需要多久？

A: 个人应用通常几分钟内通过，企业应用可能需要联系管理员审批。

### Q: 权限被拒绝怎么办？

A: 可能是权限超出应用范围。如果只需要简单的文档创建功能，可以尝试只申请必需的三个权限。

### Q: 可以使用其他方式存储文档吗？

A: 目前文档分析功能依赖飞书文档。如果无法获得飞书权限，可以考虑：
1. 使用对象存储（如S3）替代飞书文档
2. 使用本地文件存储
3. 直接在内存中处理文档（不持久化）

### Q: 如何检查权限是否已通过？

A: 在飞书开放平台的"权限管理"页面，查看权限状态。状态为"已开通"即可使用。

## 联系支持

如果遇到权限申请问题，可以：
1. 查看飞书开放平台帮助文档：https://open.feishu.cn/document/common-capabilities/overviews
2. 联系飞书技术支持
3. 联系企业管理员加速审批
