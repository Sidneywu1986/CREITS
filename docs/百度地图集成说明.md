# 百度地图集成说明

## 概述
本项目已将地图组件从 Leaflet/OpenStreetMap 迁移到百度地图。

## 配置步骤

### 1. 申请百度地图 API Key

1. 访问 [百度地图开放平台](http://lbsyun.baidu.com/apiconsole/key/create)
2. 登录或注册百度账号
3. 进入"控制台" → "应用管理" → "我的应用"
4. 点击"创建应用"
5. 填写应用信息：
   - 应用名称：REITs智能助手
   - 应用类型：浏览器端
   - 启用服务：勾选 "JavaScript API v3.0"
6. 提交后，系统会生成一个 API Key（AK）

### 2. 替换 API Key

在 `src/components/reits/BaiduMapLocationSelector.tsx` 文件中，找到以下代码：

```typescript
const script = document.createElement('script');
script.src = `https://api.map.baidu.com/api?v=3.0&ak=YOUR_BAIDU_MAP_AK&callback=initBaiduMap`;
```

将 `YOUR_BAIDU_MAP_AK` 替换为你在第1步中申请的 API Key。

### 3. 配置 Referer 白名单（可选）

为了提高安全性，可以在百度地图控制台配置 Referer 白名单：

1. 进入"我的应用" → 选择你的应用 → "设置"
2. 在"IP白名单"或"Referer白名单"中添加你的域名
3. 本地开发可以添加：`http://localhost:*` 或 `*`

## 百度地图功能

### 支持的功能
- ✅ 地图显示和缩放
- ✅ 标记点拖拽
- ✅ 点击地图选择位置
- ✅ 地址搜索（基于百度地图 LocalSearch API）
- ✅ 反向地理编码（坐标 → 地址）
- ✅ 定位到当前位置
- ✅ 分析范围圆圈显示
- ✅ 导航和缩放控件

### 使用限制

**免费版本配额：**
- 每天 6,000 次调用
- 每秒 50 次并发

**付费版本：**
- 超出免费额度后，按次计费
- 详见 [百度地图计费说明](https://lbsyun.baidu.com/apiconsole/price)

## 与 OpenStreetMap 的区别

| 特性 | 百度地图 | OpenStreetMap |
|------|---------|--------------|
| 数据准确性 | 中国国内更准确 | 全球覆盖，国内一般 |
| 搜索功能 | 优化中文搜索 | 需要额外配置 |
| API 调用限制 | 有配额限制 | 完全免费 |
| 地图样式 | 支持多种样式 | 样式较少 |
| 商业使用 | 需要授权 | 免费（OSM许可） |
| 加载速度 | 中国大陆更快 | 可能在国外更快 |

## 注意事项

1. **API Key 安全**：不要将 API Key 提交到公开的代码仓库中
2. **配额管理**：监控 API 调用量，避免超出免费额度
3. **域名限制**：生产环境建议配置 Referer 白名单
4. **错误处理**：API Key 无效时，地图会显示加载失败

## 故障排查

### 地图无法加载
- 检查 API Key 是否正确
- 检查网络连接是否正常
- 检查浏览器控制台是否有错误信息

### 搜索功能不可用
- 确认已启用 "JavaScript API v3.0" 服务
- 检查 API Key 是否有足够的配额

### 标记点无法拖拽
- 检查浏览器是否支持 HTML5 拖放功能
- 尝试刷新页面

## 回滚到 OpenStreetMap

如果需要回滚到 OpenStreetMap，请修改 `src/components/reits/MapLocationSelectorWrapper.tsx`：

```typescript
const MapLocationSelector = dynamic(
  () => import('./MapLocationSelector'), // 恢复使用原来的 Leaflet 组件
  {
    ssr: false,
    loading: () => (
      <div className="flex items-center justify-center h-96 bg-gray-100 dark:bg-gray-800 rounded-lg">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span className="ml-3 text-gray-600 dark:text-gray-400">加载地图组件...</span>
      </div>
    ),
  }
);
```

## 相关文件

- `src/components/reits/BaiduMapLocationSelector.tsx` - 百度地图组件
- `src/components/reits/MapLocationSelector.tsx` - 原 Leaflet 地图组件（已保留）
- `src/components/reits/MapLocationSelectorWrapper.tsx` - 地图组件包装器
