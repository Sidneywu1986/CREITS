# 浮窗REITs估值计算器使用说明

## 功能概述

在项目概况页面，新增了"REITs估值计算器"按钮。点击该按钮即可打开一个可拖拽、可调整大小的独立浮窗估值计算器，方便用户在查看项目信息的同时进行估值分析。

## 功能特点

### 1. 独立浮窗设计

- **可拖拽**：点击标题栏即可拖拽移动浮窗位置
- **可调整大小**：支持8个方向调整窗口大小（四角、四边）
- **最大化/还原**：支持一键最大化或还原窗口
- **最小化**：点击X按钮关闭浮窗

### 2. 紧凑布局

- 专为浮窗设计，采用紧凑的布局
- 适合小屏幕使用，不遮挡主要内容
- 三个标签页（输入参数、估值结果、分析报告）

### 3. 完整的估值功能

- DCF估值（现金流折现）
- 相对估值（PE、PB、收益率法）
- 综合估值（加权平均）
- 投资建议分析

## 使用步骤

### 1. 打开项目概况页面

访问任意REITs项目的详情页面，例如：
`http://localhost:5000/issued-reits/508009`

### 2. 点击估值计算器按钮

在"项目概况"标签页的"基本信息"卡片底部，找到"REITs估值计算器"按钮。

### 3. 操作浮窗

#### 移动浮窗
- 点击浮窗标题栏（渐变色区域）
- 按住鼠标左键拖拽到 desired 位置
- 松开鼠标完成移动

#### 调整大小
- 鼠标移动到浮窗边缘或角落
- 光标变为调整大小样式（↔、↕、⤡、⤢等）
- 按住鼠标左键拖拽调整窗口大小

#### 最大化/还原
- 点击标题栏右侧的"最大化"图标（□）
- 窗口将填充整个屏幕（减去边距）
- 再次点击还原到原始大小

#### 关闭浮窗
- 点击标题栏右侧的"关闭"图标（✕）
- 浮窗将关闭

### 4. 输入估值参数

在"输入参数"标签页中填写以下信息：

#### 基础参数
- **当前价格**：自动从实时行情读取（可手动修改）
- **年度分红**：每份年度分红金额（单位：元）
- **分红率**：自动计算

#### DCF参数
- **增长率**：建议输入2-5%
- **折现率**：建议输入7-10%

#### 相对估值参数
- **同业PE**：同行业平均市盈率
- **同业PB**：同行业平均市净率
- **同业分红率**：同行业平均分红率

### 5. 计算估值

点击"开始计算"按钮，系统将自动计算估值结果。

### 6. 查看结果

切换到"估值结果"标签页查看：
- 综合估值价格
- DCF估值结果
- 相对估值结果
- 关键财务指标

### 7. 查看分析报告

切换到"分析报告"标签页查看：
- 估值结论（增持/持有/减持）
- DCF分析说明
- 风险提示

## 浮窗组件技术说明

### 组件结构

```
DraggableFloatingWindow
├── 标题栏（可拖拽）
│   ├── 抓手图标
│   ├── 窗口标题
│   └── 控制按钮（最大化、关闭）
├── 内容区域（不可拖拽）
│   └── FloatingValuationCalculator
└── 调整大小手柄（8个方向）
    ├── 四角（NE、NW、SE、SW）
    └── 四边（N、S、E、W）
```

### 技术实现

**拖拽功能**：
- 使用 `useEffect` 监听 `mousemove` 和 `mouseup` 事件
- 计算鼠标偏移量，更新窗口位置
- 边界限制，防止窗口拖出屏幕

**调整大小功能**：
- 支持8个方向调整
- 实时计算新的宽度和高度
- 最小/最大尺寸限制
- 边界限制

**性能优化**：
- 使用 `useRef` 存储状态，避免不必要的重新渲染
- 事件监听器只在拖拽/调整时添加
- 鼠标释放后立即清理事件监听器

### 使用示例

```tsx
import DraggableFloatingWindow from '@/components/common/DraggableFloatingWindow';
import YourContent from '@/components/YourContent';

function YourPage() {
  const [showWindow, setShowWindow] = useState(false);

  return (
    <div>
      <Button onClick={() => setShowWindow(true)}>
        打开浮窗
      </Button>

      <DraggableFloatingWindow
        isOpen={showWindow}
        onClose={() => setShowWindow(false)}
        title="浮窗标题"
        initialPosition={{ x: 100, y: 100 }}
        initialSize={{ width: 500, height: 600 }}
        minSize={{ width: 400, height: 500 }}
        maxSize={{ width: 800, height: 800 }}
      >
        <YourContent />
      </DraggableFloatingWindow>
    </div>
  );
}
```

### Props说明

| 属性 | 类型 | 必填 | 说明 |
|------|------|------|------|
| isOpen | boolean | 是 | 控制浮窗显示/隐藏 |
| onClose | () => void | 是 | 关闭浮窗的回调函数 |
| title | string | 是 | 浮窗标题 |
| children | ReactNode | 是 | 浮窗内容 |
| initialPosition | {x, y} | 否 | 初始位置（默认：{x: 100, y: 100}） |
| initialSize | {width, height} | 否 | 初始大小（默认：{width: 600, height: 500}） |
| minSize | {width, height} | 否 | 最小尺寸（默认：{width: 400, height: 400}） |
| maxSize | {width, height} | 否 | 最大尺寸（默认：屏幕大小） |

## 浮窗估值计算器与全屏计算器的区别

| 特性 | 浮窗计算器 | 全屏计算器 |
|------|-----------|-----------|
| 显示方式 | 可拖拽浮窗 | 模态框居中 |
| 可移动 | 是 | 否 |
| 可调整大小 | 是 | 否 |
| 屏幕占用 | 部分 | 全部 |
| 适用场景 | 查看项目时同时估值 | 专注估值分析 |
| 详细程度 | 精简版 | 完整版 |
| 参数数量 | 基础参数 | 完整参数 |
| 图表展示 | 无 | 有（未来添加） |

## 使用建议

1. **选择合适的计算器**：
   - 查看项目详情时使用浮窗计算器
   - 深度估值分析时使用全屏计算器

2. **浮窗位置调整**：
   - 拖拽浮窗到不遮挡重要内容的位置
   - 调整窗口大小以适应屏幕

3. **多任务处理**：
   - 可以同时打开多个浮窗（未来支持）
   - 在查看项目信息的同时进行估值计算

4. **关闭浮窗**：
   - 完成估值后及时关闭浮窗
   - 避免浮窗遮挡其他内容

## 常见问题

### Q: 浮窗拖拽不流畅怎么办？

A: 可能是因为浏览器性能问题或页面内容过多。建议：
- 关闭其他不必要的标签页
- 减少页面中的动态内容
- 使用性能较好的浏览器（Chrome、Edge）

### Q: 浮窗调整大小卡顿？

A: 这是正常现象，因为每次调整都需要重新计算布局。建议：
- 一次性调整到合适大小，避免频繁调整
- 关闭浏览器硬件加速设置可能改善性能

### Q: 浮窗能保存位置和大小吗？

A: 当前版本不支持，但可以考虑在后续版本中添加此功能。

### Q: 浮窗能最小化到任务栏吗？

A: 当前版本不支持，但可以通过关闭浮窗来隐藏。

### Q: 浮窗支持多个吗？

A: 当前版本一次只能显示一个浮窗，但可以考虑在后续版本中支持多浮窗。

## 更新日志

### v1.0.0 (2026-02-14)

- ✅ 创建可拖拽浮窗组件（DraggableFloatingWindow）
- ✅ 创建浮窗版估值计算器（FloatingValuationCalculator）
- ✅ 在项目概况页面添加估值计算器按钮
- ✅ 实现8方向调整大小功能
- ✅ 实现最大化/还原功能
- ✅ 实现边界限制
- ✅ 优化拖拽性能
- ✅ 完善UI/UX设计
- ✅ 添加使用说明文档

## 未来优化方向

1. **多浮窗支持**：允许同时打开多个浮窗
2. **状态保存**：保存浮窗位置和大小到本地存储
3. **最小化功能**：最小化浮窗到屏幕底部
4. **透明度调整**：支持调整浮窗透明度
5. **主题切换**：支持更多主题样式
6. **快捷键支持**：支持键盘快捷键操作
7. **浮窗管理**：浮窗列表和切换功能
8. **窗口层级**：支持点击置顶功能
