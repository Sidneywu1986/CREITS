# REITs 数据库结构说明

## 数据表概览

本数据库包含 8 张核心表，涵盖了 REITs 产品的全生命周期数据：

| 序号 | 表名 | 核心内容 | 主键设计 | 关键字段示例 |
|------|------|----------|----------|--------------|
| 1 | reit_product_info | 产品基本要素 | reit_code | 基金代码、管理人、资产类型、杠杆率 |
| 2 | reit_property_base | 资产通用信息 | property_id + effective_date（历史追溯） | 地理位置、权证、土地信息 |
| 3 | reit_property_equity_ops | 产权类运营数据 | property_id + report_date | 出租率、租金、租约分布 |
| 4 | reit_property_concession_ops | 经营权类运营数据 | property_id + report_date | 车流量、处理量、剩余年限 |
| 5 | reit_financial_metrics | 财务指标 | reit_code + report_date | FFO、可供分配金额、分派率 |
| 6 | reit_valuation | 估值信息 | reit_code + valuation_date | 评估价值、折现率、资本化率 |
| 7 | reit_risk_compliance | 风险合规 | reit_code + info_date | 监管状态、诉讼、ESG评分 |
| 8 | reit_market_stats | 市场表现 | reit_code + trade_date | 股价、成交量、投资者结构 |

---

## 详细表结构说明

### 1. reit_product_info - 产品基本信息表

**核心功能：** 存储 REITs 基金的基本信息，是整个数据库的入口表。

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| reit_code | VARCHAR(20) | 基金代码（主键） | 如：508000.SH |
| reit_short_name | VARCHAR(100) | 基金简称 | 如：沪杭甬高速REIT |
| fund_manager | VARCHAR(100) | 基金管理人 | 管理该基金的机构 |
| asset_manager | VARCHAR(100) | 资产支持证券管理人 | |
| operator | VARCHAR(200) | 运营管理机构 | 实际运营资产的机构 |
| listing_date | DATE | 上市日期 | |
| fund_size | DECIMAL(18,4) | 基金总份额（亿份） | |
| total_assets | DECIMAL(18,4) | 募集规模/基金总资产（亿元） | |
| asset_type_national | VARCHAR(50) | 发改委大类 | 交通基础设施/消费基础设施等 |
| asset_type_csrc | VARCHAR(50) | 证监会/资产类型 | 收费公路/购物中心等 |
| product_structure | TEXT | 产品结构说明 | |
| duration_years | INT | 存续期限（年） | |
| leverage_ratio | DECIMAL(10,4) | 基金杠杆率（%） | |
| info_disclosure_officer | VARCHAR(100) | 信息披露事务负责人 | |
| disclosure_contact | VARCHAR(50) | 信息披露联系方式 | |

**使用场景：**
- 产品列表展示
- 产品详情页基本信息
- 按资产类型筛选
- 按基金管理人筛选

---

### 2. reit_property_base - 底层资产通用信息表

**核心功能：** 存储底层资产的基础信息，支持历史追溯。

**主键设计：** `property_id + effective_date`（复合主键）

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| property_id | VARCHAR(50) | 资产唯一标识 | 主键1 |
| reit_code | VARCHAR(20) | 所属REITs代码 | 外键 |
| property_name | VARCHAR(200) | 资产名称 | |
| location_province | VARCHAR(50) | 所在省份 | |
| location_city | VARCHAR(50) | 所在城市 | |
| location_district | VARCHAR(100) | 所在区域/商圈 | |
| asset_address | VARCHAR(255) | 具体地址 | |
| gross_floor_area | DECIMAL(18,4) | 总建筑面积（平方米） | |
| land_area | DECIMAL(18,4) | 占地面积（平方米） | |
| land_right_type | VARCHAR(50) | 土地权属类型 | 出让/划拨 |
| land_expiry_date | DATE | 土地使用权到期日 | |
| year_built | INT | 建成年份 | |
| year_acquired | INT | 购入年份 | |
| certificate_number | VARCHAR(100) | 权证编号 | |
| asset_encumbrance | TEXT | 资产权利限制 | 抵押/质押等 |
| effective_date | DATE | 生效日期 | 主键2 |
| expiration_date | DATE | 失效日期 | 默认9999-12-31 |

**历史追溯机制：**
- 同一资产（property_id）可以有多条记录
- 通过 `effective_date` 区分不同时期的资产信息
- 查询时取 `expiration_date` 最大的有效记录

**使用场景：**
- 资产列表展示
- 资产详情页
- 地图定位
- 资产变更历史查询

---

### 3. reit_property_equity_ops - 产权类资产运营数据表

**核心功能：** 存储产权类资产（产业园、仓储、商业、保障房）的运营数据。

**主键设计：** `property_id + report_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| property_id | VARCHAR(50) | 资产唯一标识 | 主键1 |
| report_date | DATE | 报告期 | 主键2 |
| rentable_area | DECIMAL(18,4) | 可出租面积（平方米） | |
| occupancy_rate | DECIMAL(10,4) | 出租率（%） | |
| average_rent | DECIMAL(18,4) | 平均租金（元/平方米/月） | |
| rental_income | DECIMAL(18,4) | 租金收入（万元） | |
| other_income | DECIMAL(18,4) | 其他经营收入（万元） | |
| total_operating_income | DECIMAL(18,4) | 总经营收入（万元） | |
| top_tenant_name | VARCHAR(500) | 前十大租户名称 | JSON格式 |
| top_tenant_ratio | DECIMAL(10,4) | 最大租户占比（%） | |
| top5_tenant_ratio | DECIMAL(10,4) | 前五大租户合计占比（%） | |
| wale | DECIMAL(10,4) | 加权平均租期（年） | Weighted Average Lease Expiry |
| lease_expiry_1yr | DECIMAL(10,4) | 1年内到期租约占比（%） | |
| lease_expiry_2yr | DECIMAL(10,4) | 1-2年到期租约占比（%） | |
| lease_expiry_3yr | DECIMAL(10,4) | 2-3年到期租约占比（%） | |
| lease_expiry_3plus | DECIMAL(10,4) | 3年以上到期租约占比（%） | |
| renewal_rate | DECIMAL(10,4) | 租约续签率（%） | |
| num_units | INT | 保障房套（间）数 | 保障房专用 |
| storage_capacity | DECIMAL(18,4) | 仓储容量（立方米/吨） | 仓储专用 |

**使用场景：**
- 资产运营分析
- 租金趋势分析
- 租约到期提醒
- 出租率监控

---

### 4. reit_property_concession_ops - 经营权类资产运营数据表

**核心功能：** 存储经营权类资产（高速公路、能源、环保）的运营数据。

**主键设计：** `property_id + report_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| property_id | VARCHAR(50) | 资产唯一标识 | 主键1 |
| report_date | DATE | 报告期 | 主键2 |
| **高速公路专用** | | | |
| traffic_volume_avg_daily | INT | 日均车流量（辆次） | |
| traffic_volume_total | BIGINT | 总车流量（万辆次） | |
| toll_rate_avg | DECIMAL(10,4) | 平均收费标准（元/车公里） | |
| toll_income | DECIMAL(18,4) | 通行费收入（万元） | |
| **能源/环保专用** | | | |
| processing_capacity | DECIMAL(18,4) | 处理能力 | 吨/日、兆瓦 |
| actual_processing | DECIMAL(18,4) | 实际处理量 | |
| tariff | DECIMAL(10,4) | 结算单价（元/单位） | |
| operating_revenue | DECIMAL(18,4) | 运营收入（万元） | |
| **通用字段** | | | |
| remaining_concession_years | INT | 特许经营权剩余年限 | |
| concession_expiry_date | DATE | 特许经营权到期日 | |
| major_maintenance_date | DATE | 最近大修日期 | |
| next_major_maintenance_date | DATE | 下次计划大修日期 | |
| maintenance_reserve | DECIMAL(18,4) | 大修准备金余额（万元） | |

**使用场景：**
- 车流量趋势分析
- 处理效率监控
- 特许经营权到期提醒
- 大修计划管理

---

### 5. reit_financial_metrics - 财务与估值指标表

**核心功能：** 存储 REITs 的财务指标和估值相关数据。

**主键设计：** `reit_code + report_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| reit_code | VARCHAR(20) | 基金代码 | 主键1 |
| report_date | DATE | 报告期 | 主键2 |
| report_type | VARCHAR(20) | 报告类型 | 年报/中报/季报 |
| **利润表** | | | |
| total_revenue | DECIMAL(18,4) | 营业总收入（万元） | |
| operating_cost | DECIMAL(18,4) | 营业成本（万元） | |
| gross_profit | DECIMAL(18,4) | 毛利润（万元） | |
| admin_expense | DECIMAL(18,4) | 管理费用（万元） | |
| financial_expense | DECIMAL(18,4) | 财务费用（万元） | |
| net_profit | DECIMAL(18,4) | 净利润（万元） | |
| ebitda | DECIMAL(18,4) | 息税折旧摊销前利润（万元） | |
| **REITs专用指标** | | | |
| ffo | DECIMAL(18,4) | 营运现金流FFO（万元） | Funds From Operations |
| affo | DECIMAL(18,4) | 调整后营运现金流AFFO（万元） | Adjusted FFO |
| available_for_distribution | DECIMAL(18,4) | 可供分配金额（万元） | |
| actual_distribution | DECIMAL(18,4) | 实际分红总额（万元） | |
| distribution_per_share | DECIMAL(10,4) | 每份分红（元） | |
| distribution_yield | DECIMAL(10,4) | 现金分派率（%） | 基于市值 |
| **资产负债表** | | | |
| total_assets_balance | DECIMAL(18,4) | 总资产（万元） | |
| total_liabilities | DECIMAL(18,4) | 总负债（万元） | |
| net_assets | DECIMAL(18,4) | 净资产（万元） | |
| nav_per_share | DECIMAL(10,4) | 每份额净资产（元） | Net Asset Value |
| **比率指标** | | | |
| roa | DECIMAL(10,4) | 总资产收益率（%） | |
| roe | DECIMAL(10,4) | 净资产收益率（%） | |
| dscr | DECIMAL(10,4) | 偿债覆盖倍数 | Debt Service Coverage Ratio |
| interest_coverage | DECIMAL(10,4) | 利息保障倍数 | |
| current_ratio | DECIMAL(10,4) | 流动比率 | |
| debt_to_asset | DECIMAL(10,4) | 资产负债率（%） | |

**使用场景：**
- 财务分析
- 分派率计算
- 偿债能力评估
- 盈利能力分析

---

### 6. reit_valuation - 估值与评估信息表

**核心功能：** 存储REITs的估值相关信息。

**主键设计：** `reit_code + valuation_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| reit_code | VARCHAR(20) | 基金代码 | 主键1 |
| valuation_date | DATE | 估值基准日 | 主键2 |
| report_source | VARCHAR(50) | 报告来源 | 招募说明书/评估报告/定期报告 |
| appraisal_value | DECIMAL(18,4) | 评估价值（亿元） | |
| appraisal_value_per_share | DECIMAL(10,4) | 每份额评估价值（元） | |
| valuation_method | VARCHAR(100) | 评估方法 | DCF/收益法/市场比较法等 |
| discount_rate | DECIMAL(10,4) | 折现率假设（%） | |
| terminal_growth_rate | DECIMAL(10,4) | 终值增长率假设（%） | |
| long_term_rent_growth | DECIMAL(10,4) | 长期租金增长率假设（%） | |
| cap_rate | DECIMAL(10,4) | 资本化率假设（%） | Capitalization Rate |
| vacancy_rate_assumption | DECIMAL(10,4) | 空置率假设（%） | |
| operating_cost_ratio | DECIMAL(10,4) | 运营成本占比假设（%） | |
| implied_cap_rate | DECIMAL(10,4) | 隐含资本化率 | 基于市值反算 |
| nav_premium_discount | DECIMAL(10,4) | 市净率（P/NAV） | 溢价/折价率 |

**使用场景：**
- 估值分析
- NAV折溢价监控
- 投资决策支持
- 估值敏感性分析

---

### 7. reit_risk_compliance - 风险合规信息表

**核心功能：** 存储REITs的风险和合规相关信息。

**主键设计：** `reit_code + info_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| reit_code | VARCHAR(20) | 基金代码 | 主键1 |
| info_date | DATE | 信息日期 | 主键2 |
| regulatory_status | VARCHAR(50) | 监管状态 | 正常/问询/处罚 |
| regulatory_action_desc | TEXT | 监管措施描述 | |
| legal_proceedings | TEXT | 涉及的重大诉讼或仲裁 | |
| legal_proceeding_status | VARCHAR(50) | 诉讼状态 | |
| insider_trading_policy | BOOLEAN | 内幕信息管理制度 | |
| esg_score | DECIMAL(10,4) | ESG评分 | |
| esg_rating_agency | VARCHAR(50) | ESG评级机构 | |
| related_party_transactions | TEXT | 关联交易情况 | |
| contingent_liabilities | TEXT | 或有负债 | |
| risk_factor_update | TEXT | 风险因素更新 | |

**使用场景：**
- 风险评估
- 合规监控
- ESG投资
- 投资风险提示

---

### 8. reit_market_stats - 市场表现与投资者结构表

**核心功能：** 存储REITs的市场交易数据和投资者结构。

**主键设计：** `reit_code + trade_date`

**字段说明：**

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| reit_code | VARCHAR(20) | 基金代码 | 主键1 |
| trade_date | DATE | 交易日期 | 主键2 |
| open_price | DECIMAL(10,4) | 开盘价（元） | |
| close_price | DECIMAL(10,4) | 收盘价（元） | |
| high_price | DECIMAL(10,4) | 最高价（元） | |
| low_price | DECIMAL(10,4) | 最低价（元） | |
| daily_volume | BIGINT | 日成交量（万份） | |
| daily_turnover | DECIMAL(18,4) | 日成交额（万元） | |
| turnover_rate | DECIMAL(10,4) | 换手率（%） | |
| market_cap | DECIMAL(18,4) | 总市值（万元） | |
| institutional_holding_pct | DECIMAL(10,4) | 机构投资者持有比例（%） | |
| retail_holding_pct | DECIMAL(10,4) | 个人投资者持有比例（%） | |
| top10_holder_names | TEXT | 前十大持有人名称 | JSON格式 |
| top10_holder_ratios | TEXT | 前十大持有人占比 | JSON格式 |
| top10_holder_total_pct | DECIMAL(10,4) | 前十大持有人合计占比（%） | |
| original_holder_holding_pct | DECIMAL(10,4) | 原始权益人持有比例（%） | |

**使用场景：**
- 行情展示
- 技术分析
- 投资者结构分析
- 流动性评估

---

## 数据关系图

```
reit_product_info (产品信息)
    │
    ├─→ reit_property_base (资产信息)
    │       │
    │       ├─→ reit_property_equity_ops (产权类运营数据)
    │       └─→ reit_property_concession_ops (经营权类运营数据)
    │
    ├─→ reit_financial_metrics (财务指标)
    │
    ├─→ reit_valuation (估值信息)
    │
    ├─→ reit_risk_compliance (风险合规)
    │
    └─→ reit_market_stats (市场表现)
```

---

## 索引设计建议

### 必需索引
```sql
-- reit_property_base
CREATE INDEX idx_reit_code ON reit_property_base(reit_code);
CREATE INDEX idx_effective_date ON reit_property_base(effective_date);

-- reit_financial_metrics
CREATE INDEX idx_report_date ON reit_financial_metrics(report_date);

-- reit_market_stats
CREATE INDEX idx_trade_date ON reit_market_stats(trade_date);
```

### 可选索引（根据查询需求）
```sql
-- reit_product_info
CREATE INDEX idx_asset_type_national ON reit_product_info(asset_type_national);
CREATE INDEX idx_listing_date ON reit_product_info(listing_date);

-- reit_financial_metrics
CREATE INDEX idx_reit_code_report_date ON reit_financial_metrics(reit_code, report_date);
```

---

## 数据更新频率建议

| 表名 | 更新频率 | 数据来源 |
|------|----------|----------|
| reit_product_info | 季度更新 | 定期报告 |
| reit_property_base | 按需更新 | 资产变更 |
| reit_property_equity_ops | 季度更新 | 定期报告 |
| reit_property_concession_ops | 月度更新 | 运营报告 |
| reit_financial_metrics | 季度更新 | 定期报告 |
| reit_valuation | 季度更新 | 评估报告 |
| reit_risk_compliance | 按需更新 | 监管公告 |
| reit_market_stats | 日更新 | 交易所行情 |

---

## 使用示例

### 查询某产品的完整信息
```typescript
import { reitsDB } from '@/lib/database/reits-db';

const fullProductInfo = await reitsDB.getFullProductInfo('508000.SH');
```

### 查询产品的最新财务指标
```typescript
const latestMetrics = await reitsDB.getLatestFinancialMetrics('508000.SH');
```

### 查询产品的市场表现
```typescript
const marketStats = await reitsDB.getMarketStats({
  reit_code: '508000.SH',
  start_date: new Date('2024-01-01'),
  end_date: new Date('2024-12-31'),
});
```

### 按资产类型筛选产品
```typescript
const products = await reitsDB.getAllProducts({
  asset_type_national: '交通基础设施',
  limit: 10,
});
```
