import type { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  if (req.method !== 'GET') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { reit_code } = req.query;

  if (!reit_code || typeof reit_code !== 'string') {
    return res.status(400).json({
      success: false,
      error: '缺少reit_code参数',
    });
  }

  // 财务指标数据（时间序列）
  const mockMetrics = [
    {
      reit_code: reit_code,
      report_date: '2024-09-30',
      report_type: '季报',
      total_revenue: 50000,
      operating_cost: 25000,
      gross_profit: 25000,
      admin_expense: 8000,
      financial_expense: 3000,
      net_profit: 14000,
      ebitda: 35000,
      ffo: 30000,
      affo: 28000,
      available_for_distribution: 26000,
      actual_distribution: 25000,
      distribution_per_share: 0.25,
      distribution_yield: 5.0,
      total_assets_balance: 1000000,
      total_liabilities: 200000,
      net_assets: 800000,
      nav_per_share: 8.0,
      roa: 5.0,
      roe: 6.5,
      dscr: 2.5,
      interest_coverage: 4.0,
      current_ratio: 1.5,
      debt_to_asset: 20.0,
    },
    {
      reit_code: reit_code,
      report_date: '2024-06-30',
      report_type: '季报',
      total_revenue: 48000,
      operating_cost: 24000,
      gross_profit: 24000,
      admin_expense: 7800,
      financial_expense: 2900,
      net_profit: 13300,
      ebitda: 34000,
      ffo: 29000,
      affo: 27000,
      available_for_distribution: 25000,
      actual_distribution: 24000,
      distribution_per_share: 0.24,
      distribution_yield: 4.8,
      total_assets_balance: 995000,
      total_liabilities: 198000,
      net_assets: 797000,
      nav_per_share: 7.97,
      roa: 4.8,
      roe: 6.3,
      dscr: 2.4,
      interest_coverage: 3.9,
      current_ratio: 1.5,
      debt_to_asset: 19.9,
    },
    {
      reit_code: reit_code,
      report_date: '2024-03-31',
      report_type: '季报',
      total_revenue: 46000,
      operating_cost: 23000,
      gross_profit: 23000,
      admin_expense: 7600,
      financial_expense: 2800,
      net_profit: 12600,
      ebitda: 33000,
      ffo: 28000,
      affo: 26000,
      available_for_distribution: 24000,
      actual_distribution: 23000,
      distribution_per_share: 0.23,
      distribution_yield: 4.6,
      total_assets_balance: 990000,
      total_liabilities: 196000,
      net_assets: 794000,
      nav_per_share: 7.94,
      roa: 4.6,
      roe: 6.1,
      dscr: 2.3,
      interest_coverage: 3.8,
      current_ratio: 1.5,
      debt_to_asset: 19.8,
    },
    {
      reit_code: reit_code,
      report_date: '2023-12-31',
      report_type: '年报',
      total_revenue: 45000,
      operating_cost: 22500,
      gross_profit: 22500,
      admin_expense: 7500,
      financial_expense: 2700,
      net_profit: 12300,
      ebitda: 32000,
      ffo: 27000,
      affo: 25000,
      available_for_distribution: 23000,
      actual_distribution: 22000,
      distribution_per_share: 0.22,
      distribution_yield: 4.4,
      total_assets_balance: 985000,
      total_liabilities: 194000,
      net_assets: 791000,
      nav_per_share: 7.91,
      roa: 4.5,
      roe: 5.9,
      dscr: 2.2,
      interest_coverage: 3.7,
      current_ratio: 1.5,
      debt_to_asset: 19.7,
    },
    {
      reit_code: reit_code,
      report_date: '2023-09-30',
      report_type: '季报',
      total_revenue: 44000,
      operating_cost: 22000,
      gross_profit: 22000,
      admin_expense: 7400,
      financial_expense: 2600,
      net_profit: 12000,
      ebitda: 31000,
      ffo: 26000,
      affo: 24000,
      available_for_distribution: 22000,
      actual_distribution: 21000,
      distribution_per_share: 0.21,
      distribution_yield: 4.2,
      total_assets_balance: 980000,
      total_liabilities: 192000,
      net_assets: 788000,
      nav_per_share: 7.88,
      roa: 4.4,
      roe: 5.7,
      dscr: 2.1,
      interest_coverage: 3.6,
      current_ratio: 1.5,
      debt_to_asset: 19.6,
    },
  ];

  // 按报告期排序（时间序列）
  const sortedData = [...mockMetrics].sort((a, b) =>
    new Date(a.report_date).getTime() - new Date(b.report_date).getTime()
  );

  return res.status(200).json({
    success: true,
    data: sortedData,
    count: sortedData.length,
  });
}
